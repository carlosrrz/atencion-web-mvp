<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Evaluación – Estudiante</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root{ --b:#2563eb; --bg:#f6f7fb; }
    body{margin:0;background:var(--bg);font-family:system-ui,Segoe UI,Roboto}
    header{display:flex;justify-content:space-between;align-items:center;background:linear-gradient(90deg,#60a5fa,#3b82f6);color:#fff;padding:12px 18px}
    main{max-width:1100px;margin:20px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{background:#fff;border-radius:16px;border:1px solid #e5e7eb;box-shadow:0 10px 30px #0001;padding:16px}
    h3{margin:0 0 10px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .pill{display:inline-block;border-radius:999px;padding:2px 10px;font-size:12px;background:#eef2ff}
    .help{font-size:12px;color:#6b7280}
    button{border:0;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn{background:var(--b);color:#fff} .btn-lite{background:#eef2ff}
    video,canvas{width:100%;max-height:360px;background:#000;border-radius:12px}
    label{display:block;margin:8px 0}
    ol{padding-left:18px}
    .hidden{display:none}
    a{color:#fff;text-decoration:underline}
  </style>
</head>
<body>
<header>
  <strong>Evaluación (estudiante)</strong>
  <nav><a id="logout" href="#">Salir</a></nav>
</header>

<main>
  <div class="grid">
    <section class="card">
      <h3>Datos del estudiante</h3>
      <div class="row">
        <label>Nombre<input id="stu-name" required></label>
        <label>Código<input id="stu-code"></label>
        <label>Email<input id="stu-email" type="email"></label>
      </div>
      <p class="help">Se mostrarán al encargado junto al intento.</p>
    </section>

    <section class="card" id="exam-root">
      <h3>Examen</h3>
      <form id="exam-form">
        <ol>
          <li>2 + 2 = ?
            <label><input type="radio" name="q1" value="4">4</label>
            <label><input type="radio" name="q1" value="5">5</label>
          </li>
          <li>Capital de Francia:
            <label><input type="radio" name="q2" value="Paris">París</label>
            <label><input type="radio" name="q2" value="Roma">Roma</label>
          </li>
          <li>Color del cielo despejado:
            <label><input type="radio" name="q3" value="Azul">Azul</label>
            <label><input type="radio" name="q3" value="Rojo">Rojo</label>
          </li>
          <li>3 * 3 = ?
            <label><input type="radio" name="q4" value="9">9</label>
            <label><input type="radio" name="q4" value="6">6</label>
          </li>
          <li>HTTP es un protocolo de:
            <label><input type="radio" name="q5" value="Aplicacion">Aplicación</label>
            <label><input type="radio" name="q5" value="Enlace">Enlace</label>
          </li>
        </ol>
        <button type="button" id="btn-submit-exam" class="btn">Terminar examen</button>
        <div id="exam-msg" class="help"></div>
      </form>
    </section>

    <section class="card">
      <h3>Cámara</h3>
      <div class="help">La cámara se usa solo para monitoreo (mirada, rostro cubierto, posible habla). No se muestra el detalle al estudiante.</div>
      <div style="margin:8px 0">
        <span>Estado: </span><span id="cam-status" class="pill">Permiso pendiente</span>
        <div id="cam-help" class="help"></div>
      </div>
      <video id="cam" autoplay playsinline></video>
      <canvas id="canvas" class="hidden"></canvas>
      <div class="row" style="margin-top:10px">
        <button id="btn-permitir" class="btn-lite">Permitir cámara</button>
        <button id="btn-start" class="btn">Iniciar monitoreo</button>
        <button id="btn-stop" class="btn-lite">Finalizar y enviar</button>
      </div>
    </section>
  </div>
</main>

<script type="module">
  import { requireRole, clearRole } from './roles.js';
  import './store.js';         // ya lo tienes
  import './app.js';           // tu detector actual

  requireRole('estudiante');

  // logout
  document.getElementById('logout')?.addEventListener('click', (e)=>{
    e.preventDefault(); clearRole(); location.href='index.html';
  });

  // mini corrector local del examen
  const key = { q1:'4', q2:'Paris', q3:'Azul', q4:'9', q5:'Aplicacion' };
  document.getElementById('btn-submit-exam')?.addEventListener('click', ()=>{
    const f = document.getElementById('exam-form');
    const fd = new FormData(f);
    let score=0,total=5,answers={};
    for (const k of Object.keys(key)){ const v=fd.get(k)||''; answers[k]=v; if(v===key[k]) score++; }
    window.__examResult = { score, total, answers };
    document.getElementById('exam-msg').textContent = `Examen listo. Puntaje preliminar: ${score}/${total}. Ahora pulsa “Finalizar y enviar”.`;
  });
</script>
</body>
</html>
