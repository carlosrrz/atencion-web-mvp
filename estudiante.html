<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Evaluación — Estudiante</title>
  <link rel="stylesheet" href="./src/src/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap">
      <h1>Evaluación (Estudiante)</h1>
      <nav>
        <a id="open-privacy" href="/privacidad.html">Privacidad</a>
        <a id="btn-logout" href="index.html">Salir</a>
      </nav>
    </div>
  </header>

  <main class="wrap grid-2">
    <!-- Columna izquierda: examen + cámara -->
    <section>
      <div class="card">
        <h2>Examen</h2>
        <div id="exam-root">
          <!-- exam.js inyecta el formulario aquí -->
          <button id="start-test" class="btn">Iniciar test</button>
        </div>
      </div>

      <div class="card">
        <h2>Cámara</h2>

        <p>
          Estado:
          <span id="cam-status" class="pill pill-neutral">Permiso pendiente</span>
          <span id="cam-help" class="help hidden"></span>
        </p>

        <div class="row">
          <button id="btn-permitir"   class="btn">Permitir cámara</button>
          <button id="btn-reintentar" class="btn btn-ghost">Reintentar</button>
        </div>

        <div class="cam-wrap">
          <video id="cam" autoplay playsinline muted></video>
          <canvas id="canvas" class="hidden"></canvas>
        </div>

        <div class="row">
          <button id="btn-start" class="btn btn-primary">Iniciar monitoreo</button>
          <button id="btn-stop"  class="btn btn-danger">Finalizar y exportar</button>
          <button id="btn-evidencias" class="btn btn-ghost">Evidencias</button>
        </div>

        <div class="microstatus">
          <span>Sesión: <strong id="session-status">Detenida</strong></span>
          <span>Tiempo: <strong id="session-time">00:00</strong></span>
        </div>
      </div>
    </section>

    <!-- Columna derecha: NO se muestran métricas al alumno -->
    <aside>
      <div class="card">
        <h2>Monitoreo (oculto para alumno)</h2>
        <p class="help">Las métricas en vivo no se muestran al estudiante.</p>

        <p>Pestaña: <span id="tab-state">—</span></p>
        <p>Atención: <span id="attn-state">—</span></p>
        <p>Labios: <span id="lips-state">—</span></p>

        <p>FPS: <span id="fps">0</span>
           <span id="fps-pill" class="pill pill-neutral">—</span>
           | Latencia p95: <span id="p95">0.0</span> ms
           <span id="p95-pill" class="pill pill-neutral">—</span></p>

        <p>Rendimiento: <span id="perf-overall" class="pill pill-neutral">—</span></p>

        <p>Off-tab (episodios): <span id="offtab-count">0</span> |
           Tiempo fuera: <span id="offtab-time">00:00</span></p>
      </div>
    </aside>
  </main>

  <!-- Modal de resumen -->
  <div id="summary-backdrop" class="backdrop hidden">
    <div id="summary-modal" class="modal">
      <h3>Resumen de monitoreo</h3>
      <div id="summary-body"></div>
      <div class="row end">
        <button id="summary-download-json" class="btn btn-ghost">Descargar JSON</button>
        <button id="summary-download-csv"  class="btn btn-ghost">Descargar CSV</button>
        <button id="summary-close"          class="btn btn-primary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de evidencias -->
  <div id="evidence-backdrop" class="backdrop hidden">
    <div id="evidence-modal" class="modal wide">
      <h3>Evidencias capturadas</h3>
      <div id="evidence-grid" class="ev-grid"></div>
      <div class="row end">
        <button id="btn-evid-download" class="btn btn-ghost">Descargar JSON</button>
        <button id="btn-evid-close"    class="btn btn-primary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- IMPORTANTE: módulos al FINAL, con rutas relativas a tu estructura -->
  <script type="module" src="./src/src/app.js"></script>
  <script type="module" src="./src/src/exam.js"></script>
</body>
</html>
